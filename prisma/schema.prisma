generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ReviewStatus {
  VISIBLE
  HIDDEN
  DELETED
}

model RoomReview {
  id String @id @default(uuid())

  roomId    String
  userId    String
  bookingId String @unique // 1 booking = 1 review (DB enforce)

  ratingOverall  Int
  ratingClean    Int?
  ratingLocation Int?
  ratingPrice    Int?
  ratingService  Int?

  comment String?
  status  ReviewStatus @default(VISIBLE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([roomId])
  @@index([userId])
  @@index([status])
}

model RoomRatingStat {
  roomId String @id

  totalReviews Int     @default(0)
  avgRating    Decimal @db.Decimal(3, 2)

  avgClean    Decimal?
  avgLocation Decimal?
  avgPrice    Decimal?
  avgService  Decimal?

  updatedAt DateTime @updatedAt
}
